<!DOCTYPE html> <html lang=en > <title>A Static Site Generator With Gulp, Prose.io, and Travis CI</title> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /> <link rel="shortcut icon" href="./theme/images/favicon.ico"/> <link rel=stylesheet  href="./theme/css/style.min.css?2f38b25c"> <link href="https://danielnaab.github.io/feeds/all.atom.xml" type="application/atom+xml" rel=alternate  title="Crushing Pennies Atom Feed" /> <!--[if IE]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.js"></script><![endif]--> <body id=index  class=home > <div class=sidebar-detail > <p> <a href="./"><img src="./theme/images/logo.png" width=100  height=100  alt="Graph icon"></a> </p> <p><a id=sitesubtitle  href="./"></a></p> <p><a id=aboutlink  href="./pages/about-me.html">about</a></p> <p><a href="https://danielnaab.github.io/feeds/all.atom.xml">feed</a></p> </div> <section id=content  > <div class=body > <article itemscope itemType="http://schema.org/BlogPosting"> <header> <h1 class=entry-title > <a href="./a-static-site-generator-with-gulp-proseio-and-travis-ci.html" rel=bookmark  title="Permalink to A Static Site Generator With Gulp, Prose.io, and Travis CI" itemprop=url > <span itemprop=headline >A Static Site Generator With Gulp, Prose.io, and Travis <span class=caps >CI</span></span> </a> </h1> </header> <meta itemprop=description  content="As I mentioned in my introductory post, this is a static site generated with Pelican. Now, for a new project for Lynn, a dog-trainer friend - who’s been kind enough to trade her dog-whispering services for design and web work - I wanted to create another generated static site. The benefits …" /> <div class=entry-content > <div class=post-info > <ul> <li itemprop=author  itemscope itemtype="http://schema.org/Person"> by <a class=url  href="./author/daniel-naab.html" itemprop=name >Daniel Naab</a> <li class=published  itemprop=datePublished  content="2014-11-07T15:38:00-06:00"> on&nbsp;Fri 07 November 2014 </ul> <p itemprop=keywords  content="static-site,gulp,prose.io,travis-ci,browserify,sass,swig">Tags: <a href="./tag/static-site.html" rel=tag >static-site</a> <a href="./tag/gulp.html" rel=tag >gulp</a> <a href="./tag/proseio.html" rel=tag >prose.io</a> <a href="./tag/travis-ci.html" rel=tag >travis-ci</a> <a href="./tag/browserify.html" rel=tag >browserify</a> <a href="./tag/sass.html" rel=tag >sass</a> <a href="./tag/swig.html" rel=tag >swig</a> </p> </div> <div itemprop=articleBody ><p>As I mentioned in my <a href="./hello-world.html">introductory post</a>, this is a static site generated with <a href="https://blog.getpelican.com/">Pelican</a>. Now, for a new project for Lynn, a dog-trainer friend - who&#8217;s been kind enough to trade her dog-whispering services for design and web work - I wanted to create another generated static&nbsp;site.</p> <p>The benefits are&nbsp;manifest:</p> <ul> <li>Fast load&nbsp;times. <li>Free hosting with Github&nbsp;Pages. <li>A simple deployment stack that won&#8217;t go&nbsp;down. </ul> <p>However, I need this site to be easy for Lynn to edit. She needs blog-like features, but also needs to easily be able to add new testimonials from customers, add new images, change her class schedule and service pricing, update her contact information, etc. Editing a Github repository, rebuilding, and pushing to the <code>gh-pages</code> branch is out of the&nbsp;question.</p> <p>So how does one create a <span class=caps >CMS</span>-like experience for a generated static site? <a href="https://prose.io">Prose.io</a>! With <a href="https://prose.io">prose.io</a>, we can edit Markdown files in a friendly web interface, auto-commit and push to Github. Then, with a Travis-<span class=caps >CI</span> job, the site may be auto-rebuilt and pushed to Github Pages. Even better, we can hide the non-content sections of the repository to avoid confusion. Awesomeness! Read more about this strategy <a href="https://www.developmentseed.org/blog/2012/june/25/prose-a-content-editor-for-github/">here</a> and <a href="https://www.developmentseed.org/blog/2012/07/27/build-cms-free-websites/">here</a>. There are also <a href="https://www.google.com/search?q=prose.io%20travis%20ci">several sources</a> for ideas on using <a href="https://travis-ci.org">Travis <span class=caps >CI</span></a> with <a href="https://prose.io">prose.io</a>.</p> <p>One more problem, though: all the framework-y static site generators are heavily geared toward blogs&#8230; specifically, blogs for technies. It is painful to bend a blog data model to an arbitrary content type, much less have many different data models that are all organized and rendered&nbsp;differently.</p> <p>This is where <a href="https://gulpjs.com/">gulp</a> comes in. After some consideration, I realized that gulp, which I have been enjoying using for client work and a personal project, would be a perfect fit. It provides a simple way to do processing on asset pipelines, which is exactly what a static site generator does. In addition, unlike most generators out there, I would have total control over the process and wouldn&#8217;t feel like I was working with a round-hole-square-peg blackbox. I could easily use <a href="https://sass-lang.com/"><span class=caps >SASS</span></a>, <a href="https://www.npmjs.org/">npm</a> with <a href="https://browserify.org/">Browserify</a>, whatever <a href="https://paularmstrong.github.io/swig/">template language</a> I want, etc. Plus, I could organize the project structure in the most sensible manner for this site and fully understand how the build process&nbsp;works.</p> <p>Fortunately, I wasn&#8217;t the only one who considered this possibility: Sean Farrell <a href="https://www.rioki.org/2014/06/09/jekyll-to-gulp.html">shared</a> his experiences creating such a pipeline, and I was able to steal some of his ideas. Specifically, the ideas Sean outlined that were useful to me&nbsp;were:</p> <ul> <li>Use <a href="https://www.npmjs.org/package/gulp-front-matter">gulp-front-matter</a> to parse <span class=caps >YAML</span> &#8220;front matter&#8221; from the content&nbsp;documents. <li>His method of iterating over content documents and applying front-mater and processing to each&nbsp;one. <li>Also, I decided to follow his lead and use <a href="https://paularmstrong.github.io/swig/">Swig</a> for <span class=caps >HTML</span> templating, which was a pretty natural choice for me due to its similarity to Django and&nbsp;Jinga2. </ul> <p>Beyond that, I wanted my own organization and&nbsp;workflow:</p> <ul> <li><span class=caps >SASS</span> for&nbsp;styling <li>CommonJS modules with&nbsp;Browserify <li>My preferred project&nbsp;layout <li>Travis <span class=caps >CI</span>&nbsp;deployment <li>Prose.io&nbsp;configuration </ul> <h3>Getting&nbsp;Started</h3> <p>If you want to follow along with the codebase, you may do so <a href="https://github.com/danielnaab/wunderdog/">here</a>. The live site is <a href="https://www.thewunderdog.com">here</a>.</p> <p>In the following sections, I&#8217;ll skip over some details of the build process and just focus on the big things that tie everything&nbsp;together.</p> <p>The project structure looks like&nbsp;this:</p> <ul> <li>assets/<ul> <li>images/ <li>scripts/ <li>styles/ <li>templates/ </ul> <li>content/<ul> <li>pages/ <li>posts/ <li>testimonials/ </ul> <li>.travis.yml <li>_prose.yml <li>gulpfile.js <li>package.json </ul> <h3>Compiling a Content Type:&nbsp;Testimonials</h3> <p>As you can see above, there are three content types in this project: pages, posts, and testimonials. Pages are just one-off things, like an About or Contact page. Posts correspond to blog posts, and every testimonial gets rendered to one testimonials page. Let&#8217;s take a look at how testimonials are processed by our <a href="https://github.com/danielnaab/wunderdog/blob/master/gulpfile.js"><code>gulpfile.js</code></a>. This code is largely borrowed from <a href="https://www.rioki.org/2014/06/09/jekyll-to-gulp.html">Sean Farrell</a>, and the same format is used for blog&nbsp;posts:</p> <div class=highlight ><pre><span></span><code><span class=k >var</span><span class=w > </span><span class=n >frontMatter</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=n >require</span><span class=p >(</span><span class=s1 >&#39;gulp-front-matter&#39;</span><span class=p >),</span><span class=w ></span>
<span class=w >    </span><span class=n >marked</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=n >require</span><span class=p >(</span><span class=s1 >&#39;gulp-marked&#39;</span><span class=p >)</span><span class=w ></span>

<span class=n >gulp</span><span class=o >.</span><span class=n >task</span><span class=p >(</span><span class=s1 >&#39;testimonials&#39;</span><span class=p >,</span><span class=w > </span><span class=n >function</span><span class=w > </span><span class=p >()</span><span class=w > </span><span class=p >{</span><span class=w ></span>
<span class=w >    </span><span class=k >return</span><span class=w > </span><span class=n >gulp</span><span class=o >.</span><span class=n >src</span><span class=p >(</span><span class=s1 >&#39;content/testimonials/*.md&#39;</span><span class=p >)</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >(</span><span class=n >frontMatter</span><span class=p >({</span><span class=n >property</span><span class=p >:</span><span class=w > </span><span class=s1 >&#39;page&#39;</span><span class=p >,</span><span class=w > </span><span class=n >remove</span><span class=p >:</span><span class=w > </span><span class=bp >true</span><span class=p >}))</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >(</span><span class=n >marked</span><span class=p >())</span><span class=w ></span>
<span class=w >        </span><span class=o >//</span><span class=w > </span><span class=n >Collect</span><span class=w > </span><span class=n >all</span><span class=w > </span><span class=n >the</span><span class=w > </span><span class=n >testimonials</span><span class=w > </span><span class=ow >and</span><span class=w > </span><span class=n >place</span><span class=w > </span><span class=n >them</span><span class=w > </span><span class=n >on</span><span class=w > </span><span class=n >the</span><span class=w > </span><span class=n >site</span><span class=w > </span><span class=n >object</span><span class=o >.</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >((</span><span class=n >function</span><span class=w > </span><span class=p >()</span><span class=w > </span><span class=p >{</span><span class=w ></span>
<span class=w >            </span><span class=k >var</span><span class=w > </span><span class=n >testimonials</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=p >[]</span><span class=w ></span>
<span class=w >            </span><span class=k >return</span><span class=w > </span><span class=n >through</span><span class=o >.</span><span class=n >obj</span><span class=p >(</span><span class=n >function</span><span class=w > </span><span class=p >(</span><span class=n >file</span><span class=p >,</span><span class=w > </span><span class=n >enc</span><span class=p >,</span><span class=w > </span><span class=n >cb</span><span class=p >)</span><span class=w > </span><span class=p >{</span><span class=w ></span>
<span class=w >                </span><span class=n >testimonials</span><span class=o >.</span><span class=n >push</span><span class=p >(</span><span class=n >file</span><span class=o >.</span><span class=n >page</span><span class=p >)</span><span class=w ></span>
<span class=w >                </span><span class=n >testimonials</span><span class=p >[</span><span class=n >testimonials</span><span class=o >.</span><span class=n >length</span><span class=w > </span><span class=o >-</span><span class=w > </span><span class=mi >1</span><span class=p >]</span><span class=o >.</span><span class=n >content</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=n >file</span><span class=o >.</span><span class=n >contents</span><span class=o >.</span><span class=n >toString</span><span class=p >()</span><span class=w ></span>
<span class=w >                </span><span class=n >this</span><span class=o >.</span><span class=n >push</span><span class=p >(</span><span class=n >file</span><span class=p >)</span><span class=w ></span>
<span class=w >                </span><span class=n >cb</span><span class=p >()</span><span class=w ></span>
<span class=w >            </span><span class=p >},</span><span class=w ></span>
<span class=w >            </span><span class=n >function</span><span class=w > </span><span class=p >(</span><span class=n >cb</span><span class=p >)</span><span class=w > </span><span class=p >{</span><span class=w ></span>
<span class=w >                </span><span class=n >testimonials</span><span class=o >.</span><span class=n >sort</span><span class=p >(</span><span class=n >function</span><span class=w > </span><span class=p >(</span><span class=n >a</span><span class=p >,</span><span class=w > </span><span class=n >b</span><span class=p >)</span><span class=w > </span><span class=p >{</span><span class=w ></span>
<span class=w >                    </span><span class=k >if</span><span class=w > </span><span class=p >(</span><span class=n >a</span><span class=o >.</span><span class=n >author</span><span class=w > </span><span class=o >&lt;</span><span class=w > </span><span class=n >b</span><span class=o >.</span><span class=n >author</span><span class=p >)</span><span class=w > </span><span class=p >{</span><span class=w ></span>
<span class=w >                        </span><span class=k >return</span><span class=w > </span><span class=o >-</span><span class=mi >1</span><span class=p >;</span><span class=w ></span>
<span class=w >                    </span><span class=p >}</span><span class=w ></span>
<span class=w >                    </span><span class=k >if</span><span class=w > </span><span class=p >(</span><span class=n >a</span><span class=o >.</span><span class=n >author</span><span class=w > </span><span class=o >&gt;</span><span class=w > </span><span class=n >b</span><span class=o >.</span><span class=n >author</span><span class=p >)</span><span class=w > </span><span class=p >{</span><span class=w ></span>
<span class=w >                        </span><span class=k >return</span><span class=w > </span><span class=mi >1</span><span class=p >;</span><span class=w ></span>
<span class=w >                    </span><span class=p >}</span><span class=w ></span>
<span class=w >                    </span><span class=k >return</span><span class=w > </span><span class=mi >0</span><span class=p >;</span><span class=w ></span>
<span class=w >                </span><span class=p >})</span><span class=w ></span>
<span class=w >                </span><span class=n >site</span><span class=o >.</span><span class=n >testimonials</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=n >testimonials</span><span class=w ></span>
<span class=w >                </span><span class=n >cb</span><span class=p >()</span><span class=w ></span>
<span class=w >            </span><span class=p >})</span><span class=w ></span>
<span class=w >        </span><span class=p >})())</span><span class=w ></span>
<span class=p >})</span><span class=w ></span>
</code></pre></div> <p>First, we iterate over all the testimonials, extract the front-matter, and compile the Markdown to <span class=caps >HTML</span>. Next, we create an array of testimonials, sorted by author name, and store it on the global <code>site</code> object.</p> <p>Notice that we didn&#8217;t output anything here - we just collected data that we can render later. We will later pass the <code>site</code> object into our templates. To see how we render them, have a gander at the source for the <a href="https://github.com/danielnaab/wunderdog/blob/master/content/pages/testimonials.html">testimonials page</a>.</p> <p>Now let&#8217;s take a look at how the <a href="https://github.com/danielnaab/wunderdog/tree/master/content/pages"><code>pages</code></a> are&nbsp;rendered:</p> <div class=highlight ><pre><span></span><code><span class=k >var</span><span class=w > </span><span class=n >frontMatter</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=n >require</span><span class=p >(</span><span class=s1 >&#39;gulp-front-matter&#39;</span><span class=p >),</span><span class=w ></span>
<span class=w >    </span><span class=n >marked</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=n >require</span><span class=p >(</span><span class=s1 >&#39;gulp-marked&#39;</span><span class=p >),</span><span class=w ></span>
<span class=w >    </span><span class=n >merge</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=n >require</span><span class=p >(</span><span class=s1 >&#39;merge-stream&#39;</span><span class=p >)</span><span class=w ></span>

<span class=n >gulp</span><span class=o >.</span><span class=n >task</span><span class=p >(</span><span class=s1 >&#39;pages&#39;</span><span class=p >,</span><span class=w > </span><span class=p >[</span><span class=s1 >&#39;cleanpages&#39;</span><span class=p >,</span><span class=w > </span><span class=s1 >&#39;testimonials&#39;</span><span class=p >],</span><span class=w > </span><span class=n >function</span><span class=w > </span><span class=p >()</span><span class=w > </span><span class=p >{</span><span class=w ></span>
<span class=w >    </span><span class=k >var</span><span class=w > </span><span class=n >html</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=n >gulp</span><span class=o >.</span><span class=n >src</span><span class=p >([</span><span class=s1 >&#39;content/pages/*.html&#39;</span><span class=p >])</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >(</span><span class=n >frontMatter</span><span class=p >({</span><span class=n >property</span><span class=p >:</span><span class=w > </span><span class=s1 >&#39;page&#39;</span><span class=p >,</span><span class=w > </span><span class=n >remove</span><span class=p >:</span><span class=w > </span><span class=bp >true</span><span class=p >}))</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >(</span><span class=n >through</span><span class=o >.</span><span class=n >obj</span><span class=p >(</span><span class=n >function</span><span class=w > </span><span class=p >(</span><span class=n >file</span><span class=p >,</span><span class=w > </span><span class=n >enc</span><span class=p >,</span><span class=w > </span><span class=n >cb</span><span class=p >)</span><span class=w > </span><span class=p >{</span><span class=w ></span>
<span class=w >            </span><span class=k >var</span><span class=w > </span><span class=n >data</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=p >{</span><span class=w ></span>
<span class=w >                </span><span class=n >site</span><span class=p >:</span><span class=w > </span><span class=n >site</span><span class=p >,</span><span class=w ></span>
<span class=w >                </span><span class=n >page</span><span class=p >:</span><span class=w > </span><span class=p >{}</span><span class=w ></span>
<span class=w >            </span><span class=p >}</span><span class=w ></span>
<span class=w >            </span><span class=k >var</span><span class=w > </span><span class=n >tpl</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=n >swig</span><span class=o >.</span><span class=n >compileFile</span><span class=p >(</span><span class=n >file</span><span class=o >.</span><span class=n >path</span><span class=p >)</span><span class=w ></span>
<span class=w >            </span><span class=n >file</span><span class=o >.</span><span class=n >contents</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=n >new</span><span class=w > </span><span class=n >Buffer</span><span class=p >(</span><span class=n >tpl</span><span class=p >(</span><span class=n >data</span><span class=p >),</span><span class=w > </span><span class=s1 >&#39;utf8&#39;</span><span class=p >)</span><span class=w ></span>
<span class=w >            </span><span class=n >this</span><span class=o >.</span><span class=n >push</span><span class=p >(</span><span class=n >file</span><span class=p >)</span><span class=w ></span>
<span class=w >            </span><span class=n >cb</span><span class=p >()</span><span class=w ></span>
<span class=w >        </span><span class=p >}))</span><span class=w ></span>

<span class=w >    </span><span class=k >var</span><span class=w > </span><span class=n >markdown</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=n >gulp</span><span class=o >.</span><span class=n >src</span><span class=p >(</span><span class=s1 >&#39;content/pages/*.md&#39;</span><span class=p >)</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >(</span><span class=n >frontMatter</span><span class=p >({</span><span class=n >property</span><span class=p >:</span><span class=w > </span><span class=s1 >&#39;page&#39;</span><span class=p >,</span><span class=w > </span><span class=n >remove</span><span class=p >:</span><span class=w > </span><span class=bp >true</span><span class=p >}))</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >(</span><span class=n >marked</span><span class=p >())</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >(</span><span class=n >applyTemplate</span><span class=p >(</span><span class=s1 >&#39;assets/templates/page.html&#39;</span><span class=p >))</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >(</span><span class=n >rename</span><span class=p >({</span><span class=n >extname</span><span class=p >:</span><span class=w > </span><span class=s1 >&#39;.html&#39;</span><span class=p >}))</span><span class=w ></span>

<span class=w >    </span><span class=k >return</span><span class=w > </span><span class=n >merge</span><span class=p >(</span><span class=n >html</span><span class=p >,</span><span class=w > </span><span class=n >markdown</span><span class=p >)</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >(</span><span class=n >gulpif</span><span class=p >(</span><span class=o >!</span><span class=n >DEBUG</span><span class=p >,</span><span class=w > </span><span class=n >htmlmin</span><span class=p >({</span><span class=w ></span>
<span class=w >            </span><span class=o >//</span><span class=w > </span><span class=n >This</span><span class=w > </span><span class=n >option</span><span class=w > </span><span class=n >seems</span><span class=w > </span><span class=n >logical</span><span class=p >,</span><span class=w > </span><span class=n >but</span><span class=w > </span><span class=n >it</span><span class=w > </span><span class=n >breaks</span><span class=w > </span><span class=n >gulp</span><span class=o >-</span><span class=n >rev</span><span class=o >-</span><span class=n >all</span><span class=w ></span>
<span class=w >            </span><span class=n >removeAttributeQuotes</span><span class=p >:</span><span class=w > </span><span class=bp >false</span><span class=p >,</span><span class=w ></span>

<span class=w >            </span><span class=n >removeComments</span><span class=p >:</span><span class=w > </span><span class=bp >true</span><span class=p >,</span><span class=w ></span>
<span class=w >            </span><span class=n >collapseWhitespace</span><span class=p >:</span><span class=w > </span><span class=bp >true</span><span class=p >,</span><span class=w ></span>
<span class=w >            </span><span class=n >removeRedundantAttributes</span><span class=p >:</span><span class=w > </span><span class=bp >true</span><span class=p >,</span><span class=w ></span>
<span class=w >            </span><span class=n >removeStyleLinkTypeAttributes</span><span class=p >:</span><span class=w > </span><span class=bp >true</span><span class=p >,</span><span class=w ></span>
<span class=w >            </span><span class=n >minifyJS</span><span class=p >:</span><span class=w > </span><span class=bp >true</span><span class=p >,</span><span class=w ></span>
<span class=w >            </span><span class=n >minifyCSS</span><span class=p >:</span><span class=w > </span><span class=bp >true</span><span class=p >,</span><span class=w ></span>
<span class=w >            </span><span class=n >minifyURLs</span><span class=p >:</span><span class=w > </span><span class=bp >true</span><span class=w ></span>
<span class=w >        </span><span class=p >})))</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >(</span><span class=n >gulp</span><span class=o >.</span><span class=n >dest</span><span class=p >(</span><span class=s1 >&#39;dist&#39;</span><span class=p >))</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >(</span><span class=n >connect</span><span class=o >.</span><span class=n >reload</span><span class=p >())</span><span class=w ></span>
<span class=p >})</span><span class=w ></span>
</code></pre></div> <p>Notice that we have two separate asset pipelines which are merged into one stream with the <a href="https://www.npmjs.org/package/merge-stream">merge-stream</a> module. Both pipelines, for <span class=caps >HTML</span> and Markdown, extract the front-matter from each document. All Markdown documents use the <code>assets/templates/page.html</code> template, but the <span class=caps >HTML</span> documents are expected to explicitly extend from a template. The <span class=caps >HTML</span> is rendered using the <code>applyTemplate</code> function, also borrowed from Sean Farrell. Next, the use of <code>merge-stream</code> allows us to apply common processing to both pipelines - specifically, <span class=caps >HTML</span> minification and output to the <code>dist</code> directory.</p> <p>We can then follow the same process for other asset pipelines. For instance, we could populate a <em>services page</em> with a list of items with corresponding prices, availability information, etc, all populated with front-matter data and Markdown content. Who needs a&nbsp;database?</p> <h3>Deployment</h3> <p>Skipping over the <code>dist</code> task that compiles the entire project, let&#8217;s take a look at the <code>deploy</code> task:</p> <div class=highlight ><pre><span></span><code><span class=k >var</span><span class=w > </span><span class=n >deploy</span><span class=w > </span><span class=o >=</span><span class=w > </span><span class=n >require</span><span class=p >(</span><span class=s1 >&#39;gulp-gh-pages&#39;</span><span class=p >)</span><span class=w ></span>

<span class=n >gulp</span><span class=o >.</span><span class=n >task</span><span class=p >(</span><span class=s1 >&#39;deploy&#39;</span><span class=p >,</span><span class=w > </span><span class=p >[</span><span class=s1 >&#39;dist&#39;</span><span class=p >],</span><span class=w > </span><span class=n >function</span><span class=w > </span><span class=p >()</span><span class=w > </span><span class=p >{</span><span class=w ></span>
<span class=w >    </span><span class=k >return</span><span class=w > </span><span class=n >gulp</span><span class=o >.</span><span class=n >src</span><span class=p >(</span><span class=s1 >&#39;./dist/**/*&#39;</span><span class=p >)</span><span class=w ></span>
<span class=w >        </span><span class=o >.</span><span class=n >pipe</span><span class=p >(</span><span class=n >deploy</span><span class=p >());</span><span class=w ></span>
<span class=p >})</span><span class=w ></span>
</code></pre></div> <p><a href="https://www.npmjs.org/package/gulp-gh-pages"><code>gulp-gp-pages</code></a> makes this pretty simple; we can use the defaults, but the documentation allows us to configure the git remote and origin, if&nbsp;necessary.</p> <h3>Travis <span class=caps >CI</span>&nbsp;Configuration</h3> <p>Now that we have a deploy process, we want to automate it. We should be pushing a built site every time a commit is pushed upstream. Here&#8217;s the <a href="https://github.com/danielnaab/wunderdog/blob/master/.travis.yml">.travis.yml</a> that handles that for&nbsp;us:</p> <div class=highlight ><pre><span></span><code><span class=n >branches</span><span class=o >:</span><span class=w ></span>
<span class=w >  </span><span class=n >only</span><span class=o >:</span><span class=w ></span>
<span class=w >  </span><span class=o >-</span><span class=w > </span><span class=n >master</span><span class=w ></span>
<span class=n >language</span><span class=o >:</span><span class=w > </span><span class=n >node_js</span><span class=w ></span>
<span class=n >node_js</span><span class=o >:</span><span class=w ></span>
<span class=w >  </span><span class=o >-</span><span class=w > </span><span class=s2 >&quot;0.10&quot;</span><span class=w ></span>
<span class=n >install</span><span class=o >:</span><span class=w ></span>
<span class=w >  </span><span class=o >-</span><span class=w > </span><span class=n >npm</span><span class=w > </span><span class=n >install</span><span class=w > </span><span class=o >-</span><span class=n >g</span><span class=w > </span><span class=n >gulp</span><span class=w ></span>
<span class=w >  </span><span class=o >-</span><span class=w > </span><span class=n >npm</span><span class=w > </span><span class=n >install</span><span class=w ></span>
<span class=n >before_script</span><span class=o >:</span><span class=w ></span>
<span class=w >  </span><span class=o >-</span><span class=w > </span><span class=n >git</span><span class=w > </span><span class=n >remote</span><span class=w > </span><span class=kd >set</span><span class=o >-</span><span class=n >url</span><span class=w > </span><span class=n >origin</span><span class=w > </span><span class=s2 >&quot;https://${GH_TOKEN}@github.com/danielnaab/wunderdog.git&quot;</span><span class=w ></span>
<span class=w >  </span><span class=o >-</span><span class=w > </span><span class=n >git</span><span class=w > </span><span class=n >config</span><span class=w > </span><span class=o >--</span><span class=n >global</span><span class=w > </span><span class=n >user</span><span class=o >.</span><span class=na >email</span><span class=w > </span><span class=s2 >&quot;dan@crushingpennies.com&quot;</span><span class=w ></span>
<span class=w >  </span><span class=o >-</span><span class=w > </span><span class=n >git</span><span class=w > </span><span class=n >config</span><span class=w > </span><span class=o >--</span><span class=n >global</span><span class=w > </span><span class=n >user</span><span class=o >.</span><span class=na >name</span><span class=w > </span><span class=s2 >&quot;Travis-CI&quot;</span><span class=w ></span>
<span class=n >script</span><span class=o >:</span><span class=w ></span>
<span class=w >  </span><span class=o >-</span><span class=w > </span><span class=n >gulp</span><span class=w > </span><span class=n >deploy</span><span class=w ></span>
<span class=n >env</span><span class=o >:</span><span class=w ></span>
<span class=w >  </span><span class=n >global</span><span class=o >:</span><span class=w ></span>
<span class=w >  </span><span class=o >-</span><span class=w > </span><span class=n >secure</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;jTbRauX2+9E9WbSI6pu4oXO3P60d3KriWQr7sD39JArrXFqs3ZpeT0gdycmE4OlYS/t1MY7yzKFw2MPeyIO2tl5zIBRLx77GZRwqkKi0Y4Uu5nRNkOBiPsrVD7Iq5gLuknQGbLCHf2p+1MmtQbsuEVTSkV/FWzCxk2j0nRUm2ng=&quot;</span><span class=w ></span>
</code></pre></div> <p>Basically, we install our dependencies, set the origin with <code>https://</code> rather than <code>git://</code> (because we&#8217;re pushing), with an included Github auth token. Then, we run the deploy&nbsp;task.</p> <p>To set <code>GH_TOKEN</code>, we first need a Github auth token. Github <a href="https://help.github.com/articles/creating-an-access-token-for-command-line-use/">provides instructions</a> for how to do that. Next, we need to encrypt the token so it&#8217;s not committed as plain text for the world to read; we can use the <a href="https://rubygems.org/gems/travis"><code>travis</code> command line tool</a> for&nbsp;that:</p> <div class=highlight ><pre><span></span><code>gem install travis
travis encrypt <span class=nv >GH_TOKEN</span><span class=o >=</span>&lt;Github auth token&gt;
</code></pre></div> <p>This will output the <code>secure: XXXXX</code> line seen above. Add it to your <code>.travis.yml</code>, and you&#8217;re good to go! Commit, grab a beer, and your site will be updated in a&nbsp;few.</p> <h3>Prose.io&nbsp;Configuration</h3> <p>Now, onto <a href="https://rubygems.org/gems/travis">prose.io</a>. It&#8217;s easy enough to log in to the site, and at this point, we may make edits and things will <em>just work</em>. Remember, though, we want the data-entry <span class=caps >UI</span> to be as easy as possible and not include extraneous crud. We may create a <a href="https://github.com/prose/prose/wiki/Prose-Configuration"><code>_prose.yml</code></a> to define the kind of interface prose.io should generate for&nbsp;us:</p> <div class=highlight ><pre><span></span><code><span class=n >prose</span><span class=o >:</span><span class=w ></span>
<span class=w >  </span><span class=n >rooturl</span><span class=o >:</span><span class=w > </span><span class=s1 >&#39;content&#39;</span><span class=w ></span>
<span class=w >  </span><span class=n >siteurl</span><span class=o >:</span><span class=w > </span><span class=s1 >&#39;https://blog.crushingpennies.com/wunderdog/&#39;</span><span class=w ></span>
<span class=w >  </span><span class=n >media</span><span class=o >:</span><span class=w > </span><span class=s1 >&#39;content/media&#39;</span><span class=w ></span>
<span class=w >  </span><span class=n >metadata</span><span class=o >:</span><span class=w ></span>
<span class=w >    </span><span class=n >content</span><span class=o >/</span><span class=n >posts</span><span class=o >:</span><span class=w ></span>
<span class=w >      </span><span class=o >-</span><span class=w > </span><span class=n >name</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;published&quot;</span><span class=w ></span>
<span class=w >        </span><span class=n >field</span><span class=o >:</span><span class=w ></span>
<span class=w >          </span><span class=n >element</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;checkbox&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >label</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Published&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >help</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Uncheck to make this post hidden.&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >value</span><span class=o >:</span><span class=w > </span><span class=kc >true</span><span class=w ></span>
<span class=w >          </span><span class=n >on</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;true&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >off</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;false&quot;</span><span class=w ></span>
<span class=w >      </span><span class=o >-</span><span class=w > </span><span class=n >name</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;title&quot;</span><span class=w ></span>
<span class=w >        </span><span class=n >field</span><span class=o >:</span><span class=w ></span>
<span class=w >          </span><span class=n >element</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;text&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >label</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Title&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >help</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;The blog post title&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >placeholder</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Enter title&quot;</span><span class=w ></span>
<span class=w >      </span><span class=o >-</span><span class=w > </span><span class=n >name</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;date&quot;</span><span class=w ></span>
<span class=w >        </span><span class=n >field</span><span class=o >:</span><span class=w ></span>
<span class=w >          </span><span class=n >element</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;text&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >label</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Publication Date&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >help</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;The publication date for this post.&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >placeholder</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Enter date in the form YYYY-MM-DD&quot;</span><span class=w ></span>
<span class=w >      </span><span class=o >-</span><span class=w > </span><span class=n >name</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;allowComments&quot;</span><span class=w ></span>
<span class=w >        </span><span class=n >field</span><span class=o >:</span><span class=w ></span>
<span class=w >          </span><span class=n >element</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;checkbox&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >label</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Allow Comments&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >help</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Allow users to comment with Disqus.&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >value</span><span class=o >:</span><span class=w > </span><span class=kc >true</span><span class=w ></span>
<span class=w >          </span><span class=n >on</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;true&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >off</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;false&quot;</span><span class=w ></span>
<span class=w >    </span><span class=n >content</span><span class=o >/</span><span class=n >testimonials</span><span class=o >:</span><span class=w ></span>
<span class=w >      </span><span class=o >-</span><span class=w > </span><span class=n >name</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;published&quot;</span><span class=w ></span>
<span class=w >        </span><span class=n >field</span><span class=o >:</span><span class=w ></span>
<span class=w >          </span><span class=n >element</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;checkbox&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >label</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Published&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >help</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Uncheck to make this testimonial hidden.&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >value</span><span class=o >:</span><span class=w > </span><span class=kc >true</span><span class=w ></span>
<span class=w >          </span><span class=n >on</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;true&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >off</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;false&quot;</span><span class=w ></span>
<span class=w >      </span><span class=o >-</span><span class=w > </span><span class=n >name</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;author&quot;</span><span class=w ></span>
<span class=w >        </span><span class=n >field</span><span class=o >:</span><span class=w ></span>
<span class=w >          </span><span class=n >element</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;text&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >label</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Author&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >help</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;The name of the author of this testimonial.&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >placeholder</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Enter author name&quot;</span><span class=w ></span>
<span class=w >      </span><span class=o >-</span><span class=w > </span><span class=n >name</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;authorLocation&quot;</span><span class=w ></span>
<span class=w >        </span><span class=n >field</span><span class=o >:</span><span class=w ></span>
<span class=w >          </span><span class=n >element</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;text&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >label</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Author Location&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >help</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;The location of the author of this testimonial.&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >placeholder</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Enter author location&quot;</span><span class=w ></span>
<span class=w >      </span><span class=o >-</span><span class=w > </span><span class=n >name</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;authorUrl&quot;</span><span class=w ></span>
<span class=w >        </span><span class=n >field</span><span class=o >:</span><span class=w ></span>
<span class=w >          </span><span class=n >element</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;text&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >label</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Author URL&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >help</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;A web URL for this author, if available.&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >placeholder</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Enter author URL&quot;</span><span class=w ></span>
<span class=w >      </span><span class=o >-</span><span class=w > </span><span class=n >name</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;signees&quot;</span><span class=w ></span>
<span class=w >        </span><span class=n >field</span><span class=o >:</span><span class=w ></span>
<span class=w >          </span><span class=n >element</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;hidden&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >label</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;Signees/signatories&quot;</span><span class=w ></span>
<span class=w >          </span><span class=n >help</span><span class=o >:</span><span class=w > </span><span class=s2 >&quot;If there is more than one author for this testimonial, enter them here.&quot;</span><span class=w ></span>
</code></pre></div> <h3>Summary</h3> <p><code>gulp</code> + <code>prose.io</code> + <code>Travis CI</code> = awesome. I&#8217;m pretty pleased with the gulp asset workflow, in particular, and intend to follow these patterns for a couple more content types and hopefully streamline the process a&nbsp;bit.</p> <p>As this project is finished out with a finalized design and interactivity with Javascript, I&#8217;ll update this post with any new ideas. Anyone else out there using gulp for static site&nbsp;generation?</p></div> </div> <div class=comments > <div id=disqus_thread ></div> <script> var disqus_identifier = "a-static-site-generator-with-gulp-proseio-and-travis-ci.html"; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = 'http://crushingpennies.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> </div> </article> </div> </section> <section id=extras > </section> <footer id=contentinfo > <address id=about > </address> </footer> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-53242625-1', 'auto'); ga('require', 'displayfeatures'); ga('send', 'pageview'); </script> <script> var disqus_shortname = 'crushingpennies'; (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = 'https://' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script>